<ion-header>
  <ion-toolbar>
    <ion-title>Dashboard</ion-title>
    <ion-button slot="end" fill="clear" (click)="refreshMetrics()">
      <ion-icon slot="icon-only" name="refresh-outline"></ion-icon>
    </ion-button>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">
  <div class="dashboard-container" *ngIf="metrics">
    <!-- Storage Warning Alert (FR-009, T046) -->
    <ion-card *ngIf="storageWarning" color="warning" class="warning-card">
      <ion-card-content>
        <div class="warning-content">
          <ion-icon name="warning-outline" class="warning-icon"></ion-icon>
          <div>
            <strong>Storage Warning</strong>
            <p>Storage usage is at {{ metrics.storageUsed.percentage }}%. Consider deleting old files.</p>
          </div>
        </div>
      </ion-card-content>
    </ion-card>

    <!-- Quick Actions (FR-010, T047) -->
    <div class="quick-actions">
      <ion-button expand="block" (click)="navigateToCreate('article')" color="primary">
        <ion-icon slot="start" name="document-text-outline"></ion-icon>
        Create Article
      </ion-button>
      <ion-button expand="block" (click)="navigateToCreate('part')" color="primary">
        <ion-icon slot="start" name="hardware-chip-outline"></ion-icon>
        Create Part
      </ion-button>
      <ion-button expand="block" (click)="navigateToCreate('topic')" color="primary">
        <ion-icon slot="start" name="pricetags-outline"></ion-icon>
        Create Topic
      </ion-button>
    </div>

    <!-- Metrics Grid (FR-007, T040, T043, T044) -->
    <div class="metrics-grid">
      <app-metric-card
        label="Total Articles"
        [value]="metrics.totalArticles"
        icon="document-text-outline"
      ></app-metric-card>

      <app-metric-card
        label="Topics"
        [value]="metrics.totalTopics"
        icon="pricetags-outline"
      ></app-metric-card>

      <app-metric-card
        label="Computer Parts"
        [value]="metrics.totalParts"
        icon="hardware-chip-outline"
      ></app-metric-card>

      <app-metric-card
        label="Recent Uploads"
        [value]="metrics.recentUploads"
        icon="cloud-upload-outline"
        detail="Last 7 days"
      ></app-metric-card>

      <app-metric-card
        label="Pending Drafts"
        [value]="metrics.pendingDrafts"
        icon="document-outline"
      ></app-metric-card>

      <app-metric-card
        label="Storage Used"
        [value]="metrics.storageUsed.percentage + '%'"
        icon="cloud-outline"
        [detail]="formatBytes(metrics.storageUsed.bytes)"
        [warning]="storageWarning"
      ></app-metric-card>
    </div>

    <!-- Activity Feed (FR-008, T043) -->
    <ion-card class="activity-card">
      <ion-card-header>
        <ion-card-title>Recent Activity</ion-card-title>
        <ion-card-subtitle>Last 20 actions â€¢ Updates every 30 seconds</ion-card-subtitle>
      </ion-card-header>
      <ion-card-content>
        <ion-list *ngIf="activities.length > 0; else noActivity">
          <ion-item *ngFor="let activity of activities" lines="inset">
            <ion-icon slot="start" [name]="getActionIcon(activity.action_type)"></ion-icon>
            <ion-label>
              <h3>{{ formatActionType(activity.action_type) }}</h3>
              <p *ngIf="activity.item_title">
                {{ activity.item_type }}: {{ activity.item_title }}
              </p>
              <p class="activity-meta">
                <span>{{ activity.admin_email }}</span>
                <span class="timestamp">{{ formatTimestamp(activity.created_at) }}</span>
              </p>
            </ion-label>
          </ion-item>
        </ion-list>
        <ng-template #noActivity>
          <div class="empty-state">
            <ion-icon name="list-outline" class="empty-icon"></ion-icon>
            <p>No activity yet</p>
          </div>
        </ng-template>
        <ion-button expand="block" fill="clear" routerLink="/admin/activity" class="view-all-btn">
          View All Activity
          <ion-icon slot="end" name="arrow-forward-outline"></ion-icon>
        </ion-button>
      </ion-card-content>
    </ion-card>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="loading-container">
    <ion-spinner></ion-spinner>
    <p>Loading dashboard...</p>
  </div>
</ion-content>
